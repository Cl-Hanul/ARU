from PIL import Image, ImageOps, ImageDraw, ImageFont
from io import BytesIO

base = Image.open(r'image_assets\weather\Weather Base.png').resize((256,384)) #512x768
basesize = (256,384)
font = ImageFont.truetype("font/학교안심 가을소풍B.ttf",90)
tempfont = ImageFont.truetype("font/학교안심 가을소풍B.ttf",70)

Cloudy = Image.open(r"image_assets\weather\Cloudy.png")
Hazy = Image.open(r"image_assets\weather\Hazy.png")
Rain = Image.open(r"image_assets\weather\Rain.png")
RainSnow = Image.open(r"image_assets\weather\RainSnow.png")
Snow = Image.open(r"image_assets\weather\Snow.png")
Sonagi = Image.open(r"image_assets\weather\Sonagi.png")
Sunny = Image.open(r"image_assets\weather\Sunny.png")

def getweatherimage(weatherlist:list) -> Image.Image:
    row = 13
    bg = Image.new('RGB',(basesize[0]*row,basesize[1]*(len(weatherlist)//row+1)+(len(weatherlist)//row*4)))
    bgdraw = ImageDraw.Draw(bg)

    for i in range(len(weatherlist)):
        def startPos(addX:int,addY:int) -> tuple:
            return (basesize[0]*(i%row)+addX,basesize[1]*(i//row)+addY+i//row*4)
        bg.paste(base,startPos(0,0))
        
        weatherTime = f"{weatherlist[i]['WeatherTime'][9:11]}:{weatherlist[i]['WeatherTime'][11:]}"
        bgdraw.text(startPos(128,60),f"{weatherTime}",font=font,anchor="ms")
        bgdraw.text(startPos(128,370),f"{weatherlist[i]['TMP']}˚C",font=tempfont,anchor="ms")

        iconPos = startPos(0,50)
        if (weatherlist[i]['PTY'] == '1') or (weatherlist[i]['PTY'] == '4'):
            bg.paste(Rain,iconPos,mask=Rain)
            continue
        if weatherlist[i]['PTY'] == '2':
            bg.paste(RainSnow,iconPos,mask=RainSnow)
            continue
        if weatherlist[i]['PTY'] == '3':
            bg.paste(Snow,iconPos,mask=Snow)
            continue
        if weatherlist[i]['SKY'] == '1':
            bg.paste(Sunny,iconPos,mask=Sunny)
        if weatherlist[i]['SKY'] == '3':
            bg.paste(Cloudy,iconPos,mask=Cloudy)
        if weatherlist[i]['SKY'] == '4':
            bg.paste(Hazy,iconPos,mask=Hazy)
    return bg
    
if __name__ == "__main__":
    weatherdata = [
        {'WeatherTime': '20230929_0900', 'TMP': '18', 'UUU': '-1', 'VVV': '-0.2', 'VEC': '80', 'WSD': '1.1', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1000', 'TMP': '19', 'UUU': '-0.6', 'VVV': '-0.1', 'VEC': '82', 'WSD': '0.7', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '70', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1100', 'TMP': '21', 'UUU': '-0.9', 'VVV': '0.2', 'VEC': '101', 'WSD': '1', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1200', 'TMP': '22', 'UUU': '0', 'VVV': '-0.2', 'VEC': '360', 'WSD': '0.2', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '60', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1300', 'TMP': '22', 'UUU': '0.7', 'VVV': '-0.3', 'VEC': '293', 'WSD': '0.8', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '55', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1400', 'TMP': '22', 'UUU': '1.3', 'VVV': '-0.2', 'VEC': '279', 'WSD': '1.3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '55', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1500', 'TMP': '22', 'UUU': '1.8', 'VVV': '-0.3', 'VEC': '279', 'WSD': '1.8', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '55', 'SNO': '적설없음', 'TMX': '23.0'}, {'WeatherTime': '20230929_1600', 'TMP': '21', 'UUU': '2.1', 'VVV': '-0.6', 'VEC': '286', 'WSD': '2.2', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '55', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1700', 'TMP': '20', 'UUU': '1.6', 'VVV': '-0.8', 'VEC': '297', 'WSD': '1.8', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': ' 강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1800', 'TMP': '18', 'UUU': '1.1', 'VVV': '-0.4', 'VEC': '290', 'WSD': '1.2', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '75', 'SNO': '적설없음'}, {'WeatherTime': '20230929_1900', 'TMP': '17', 'UUU': '1.3', 'VVV': '-1', 'VEC': '308', 'WSD': '1.6', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230929_2000', 'TMP': '16', 'UUU': '0.6', 'VVV': '-0.9', 'VEC': '326', 'WSD': '1.1', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230929_2100', 'TMP': '16', 'UUU': '0.6', 'VVV': '-0.9', 'VEC': '326', 'WSD': '1.1', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230929_2200', 'TMP': '15', 'UUU': '0.5', 'VVV': '-1', 'VEC': '333', 'WSD': '1.1', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230929_2300', 'TMP': '15', 'UUU': '0.7', 'VVV': '-1.5', 'VEC': '335', 'WSD': '1.7', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0000', 'TMP': '15', 'UUU': '0.6', 'VVV': '-1.5', 'VEC': '338', 'WSD': '1.6', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0100', 'TMP': '15', 'UUU': '0.1', 'VVV': '-0.9', 'VEC': '354', 'WSD': '0.9', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0200', 'TMP': '16', 'UUU': '0.8', 'VVV': '-0.5', 'VEC': '302', 'WSD': '0.9', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0300', 'TMP': '15', 'UUU': '0', 'VVV': '1.6', 'VEC': '180', 'WSD': '1.6', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0400', 'TMP': '15', 'UUU': '-0.4', 'VVV': '3', 'VEC': '171', 'WSD': '3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0500', 'TMP': '15', 'UUU': '-0.4', 'VVV': '2.2', 'VEC': '167', 'WSD': '2.3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0600', 'TMP': '15', 'UUU': '0', 'VVV': '1.3', 'VEC': '176', 'WSD': '1.3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음', 'TMN': '15.0'}, {'WeatherTime': '20230930_0700', 'TMP': '15', 'UUU': '0.1', 'VVV': '0.9', 'VEC': '186', 'WSD': '0.9', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0800', 'TMP': '16', 'UUU': '0.2', 'VVV': '1.1', 'VEC': '190', 'WSD': '1.1', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_0900', 'TMP': '18', 'UUU': '0.6', 'VVV': '1.5', 'VEC': '202', 'WSD': '1.6', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '75', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1000', 'TMP': '20', 'UUU': '1.1', 'VVV': '1.2', 'VEC': '223', 'WSD': '1.6', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '70', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1100', 'TMP': '21', 'UUU': '1.7', 'VVV': '0.7', 'VEC': '248', 'WSD': '1.8', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1200', 'TMP': '22', 'UUU': '2', 'VVV': '0.4', 'VEC': '259', 'WSD': '2', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '60', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1300', 'TMP': '22', 'UUU': '2.3', 'VVV': '0.3', 'VEC': '263', 'WSD': '2.3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1400', 'TMP': '22', 'UUU': '2.7', 'VVV': '0.1', 'VEC': '268', 'WSD': '2.7', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1500', 'TMP': '21', 'UUU': '2.9', 'VVV': '0', 'VEC': '270', 'WSD': '2.9', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '70', 'SNO': '적설없음', 'TMX': '23.0'}, {'WeatherTime': '20230930_1600', 'TMP': '21', 'UUU': '3', 'VVV': '-0.1', 'VEC': '272', 'WSD': '3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '70', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1700', 'TMP': '20', 'UUU': '2.8', 'VVV': '-0.1', 'VEC': '272', 'WSD': '2.8', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '75', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1800', 'TMP': '18', 'UUU': '1.8', 'VVV': '0.1', 'VEC': '267', 'WSD': '1.8', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20230930_1900', 'TMP': '17', 'UUU': '1.3', 'VVV': '0.2', 'VEC': '261', 'WSD': '1.3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20230930_2000', 'TMP': '17', 'UUU': '1.3', 'VVV': '0.1', 'VEC': '266', 'WSD': '1.3', 'SKY': '4', 'PTY': '0', 'POP': '30', 'WAV': '0', 'PCP': '강수없음', 'REH': '90', 'SNO': '적설없음'}, {'WeatherTime': '20230930_2100', 'TMP': '16', 'UUU': '1.3', 'VVV': '-0.1', 'VEC': '274', 'WSD': '1.3', 'SKY': '4', 'PTY': '0', 'POP': '30', 'WAV': '0', 'PCP': '강수없음', 'REH': '90', 'SNO': '적설없음'}, {'WeatherTime': '20230930_2200', 'TMP': '16', 'UUU': '1.3', 'VVV': '-0.2', 'VEC': '279', 'WSD': '1.3', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '90', 'SNO': '적설없음'}, {'WeatherTime': '20230930_2300', 'TMP': '15', 'UUU': '1.3', 'VVV': '-0.8', 'VEC': '302', 'WSD': '1.5', 'SKY': '3', 'PTY': '0', 'POP': '20', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0000', 'TMP': '15', 'UUU': '1.3', 'VVV': '-1.1', 'VEC': '310', 'WSD': '1.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0100', 'TMP': '14', 'UUU': '1.1', 'VVV': '-0.7', 'VEC': '302', 'WSD': '1.3', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0200', 'TMP': '13', 'UUU': '1.1', 'VVV': '-0.7', 'VEC': '302', 'WSD': '1.3', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0300', 'TMP': '12', 'UUU': '1.1', 'VVV': '-0.6', 'VEC': '299', 'WSD': '1.3', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0400', 'TMP': '12', 'UUU': '1.1', 'VVV': '-0.3', 'VEC': '285', 'WSD': '1.1', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0500', 'TMP': '12', 'UUU': '1.1', 'VVV': '-0.8', 'VEC': '306', 'WSD': '1.4', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0600', 'TMP': '12', 'UUU': '1.2', 'VVV': '-1.2', 'VEC': '315', 'WSD': '1.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음', 'TMN': '11.0'}, {'WeatherTime': '20231001_0700', 'TMP': '12', 'UUU': '1.1', 'VVV': '-1.5', 'VEC': '324', 'WSD': '1.9', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0800', 'TMP': '14', 'UUU': '1.4', 'VVV': '-2.3', 'VEC': '329', 'WSD': '2.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '75', 'SNO': '적설없음'}, {'WeatherTime': '20231001_0900', 'TMP': '17', 'UUU': '1.8', 'VVV': '-3.2', 'VEC': '331', 'WSD': '3.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1000', 'TMP': '18', 'UUU': '1.8', 'VVV': '-3.2', 'VEC': '331', 'WSD': '3.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '50', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1100', 'TMP': '19', 'UUU': '1.6', 'VVV': '-3.4', 'VEC': '335', 'WSD': '3.8', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '45', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1200', 'TMP': '20', 'UUU': '1.5', 'VVV': '-3.4', 'VEC': '336', 'WSD': '3.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '40', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1300', 'TMP': '20', 'UUU': '1.3', 'VVV': '-3.6', 'VEC': '340', 'WSD': '3.8', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '40', 'SNO': ' 적설없음'}, {'WeatherTime': '20231001_1400', 'TMP': '21', 'UUU': '0.9', 'VVV': '-3.8', 'VEC': '347', 'WSD': '3.9', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '40', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1500', 'TMP': '20', 'UUU': '0.6', 'VVV': '-3.9', 'VEC': '351', 'WSD': '3.9', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '40', 'SNO': '적설없음', 'TMX': '21.0'}, {'WeatherTime': '20231001_1600', 'TMP': '19', 'UUU': '0.5', 'VVV': '-3.3', 'VEC': '351', 'WSD': '3.3', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '45', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1700', 'TMP': '18', 'UUU': '0.6', 'VVV': '-2.3', 'VEC': '345', 'WSD': '2.4', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '50', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1800', 'TMP': '16', 'UUU': '0.8', 'VVV': '-1.5', 'VEC': '332', 'WSD': '1.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '60', 'SNO': '적설없음'}, {'WeatherTime': '20231001_1900', 'TMP': '14', 'UUU': '0.8', 'VVV': '-1.5', 'VEC': '332', 'WSD': '1.7', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '65', 'SNO': '적설없음'}, {'WeatherTime': '20231001_2000', 'TMP': '13', 'UUU': '0.5', 'VVV': '-1.4', 'VEC': '340', 'WSD': '1.5', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '75', 'SNO': '적설없음'}, {'WeatherTime': '20231001_2100', 'TMP': '12', 'UUU': '0', 'VVV': '-2', 'VEC': '360', 'WSD': '2', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_2200', 'TMP': '12', 'UUU': '0', 'VVV': '-1.6', 'VEC': '4', 'WSD': '1.6', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231001_2300', 'TMP': '11', 'UUU': '0.1', 'VVV': '-1.3', 'VEC': '356', 'WSD': '1.3', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '80', 'SNO': '적설없음'}, {'WeatherTime': '20231002_0000', 'TMP': '11', 'UUU': '0.2', 'VVV': '-1.5', 'VEC': '352', 'WSD': '1.5', 'SKY': '1', 'PTY': '0', 'POP': '0', 'WAV': '0', 'PCP': '강수없음', 'REH': '85', 'SNO': '적설없음'}]
    getweatherimage(weatherdata).show()